{% extends 'base.html' %}

{% block title %}Leaderboard - Petanque Platform{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">{{ tournament.name }} Leaderboard</h1>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Standings</h5>
                </div>
                <div class="card-body">
                    {% if entries %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Position</th>
                                        <th>Team</th>
                                        <th>Matches Played</th>
                                        <th>Won</th>
                                        <th>Lost</th>
                                        {% if is_swiss %}
                                            <th>Swiss Points</th>
                                            <th>Buchholz Score</th>
                                        {% elif is_wtf %}
                                            <th>Swiss Points</th>
                                            <th>πετΑ Index</th>
                                        {% endif %}
                                        <th>Points Scored</th>
                                        <th>Points Conceded</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry in entries %}
                                        <tr>
                                            <td>{{ entry.position }}</td>
                                            <td>
                                                <a href="{% url 'team_detail' entry.team.id %}">
                                                    {{ entry.team.name }}
                                                </a>
                                            </td>
                                            <td>{{ entry.matches_played }}</td>
                                            <td>{{ entry.matches_won }}</td>
                                            <td>{{ entry.matches_lost }}</td>
                                            {% if is_swiss %}
                                                <td><strong>{{ entry.swiss_points|default:0 }}</strong></td>
                                                <td>{{ entry.buchholz_score|default:0|floatformat:1 }}</td>
                                            {% elif is_wtf %}
                                                <td><strong>{{ entry.swiss_points|default:0 }}</strong></td>
                                                <td><strong>{{ entry.buchholz_score|default:0|floatformat:3 }}</strong></td>
                                            {% endif %}
                                            <td>{{ entry.points_scored }}</td>
                                            <td>{{ entry.points_conceded }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        {% if is_swiss %}
                            <div class="mt-3">
                                <small class="text-muted">
                                    <strong>Swiss Tournament Ranking:</strong> Teams are ranked by Swiss Points (3 per win), 
                                    then by Buchholz Score (sum of opponents' Swiss points) for tie-breaking.
                                </small>
                            </div>
                        {% elif is_wtf %}
                            <div class="mt-3">
                                <small class="text-muted">
                                    <strong>WTF (πετΑ Index) Tournament Ranking:</strong> Teams are ranked by πετΑ Index, 
                                    which considers Strength of Schedule (SoS), Quality of Resistance (QoR), 
                                    Swiss Soft Factor (SSF), and optional Base Rating (BR). 
                                    This system rewards quality of opposition and resistance, not just victories.
                                </small>
                            </div>
                        {% endif %}
                    {% else %}
                        <p class="text-muted">No leaderboard entries found.</p>
                    {% endif %}
                </div>
            </div>
            
            <div class="mt-4">
                <a href="{% url 'tournament_detail' tournament.id %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Tournament
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
